<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 11. Using the Docserv² API</title><link rel="stylesheet" type="text/css" href="static/css/docserv-style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="index.html" title="Docserv² Guide" /><link rel="up" href="index.html" title="Docserv² Guide" /><link rel="prev" href="backup.html" title="Chapter 10. Backing up Docserv² data" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 11. Using the Docserv² API</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="api"></a>Chapter 11. Using the Docserv² API</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="api.html#api-client-dscmd">The dscmd command-line API client</a></span></dt><dt><span class="section"><a href="api.html#api-call">API calls</a></span></dt><dd><dl><dt><span class="section"><a href="api.html#api-check-build">Checking build status</a></span></dt><dt><span class="section"><a href="api.html#api-send-build-instruction">Sending a build instruction</a></span></dt></dl></dd></dl></div><p>Docserv² includes a nascent (read, "not particularly good") REST API.</p><p>The API runs at the API interface defined via the site configuration’s <code class="literal">host</code> and <code class="literal">port</code> attributes.
For more information, see <a class="xref" href="config-site.html#config-site-server-section" title="The [server] section">the section called “The <code class="literal">[server]</code> section”</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api-client-dscmd"></a>The dscmd command-line API client</h2></div></div></div><p>The official API client is dscmd which is available as an RPM package from the openSUSE Build Service’s <code class="literal">Documentation:Tools</code> repository or from the <a class="link" href="https://github.com/openSUSE/dscmd" target="_top">dscmd GitHub repository</a>.
Installation from the RPM works analogously to that of Docserv² itself, see <a class="xref" href="install-start.html#install" title="Installing Docserv²">the section called “Installing Docserv²”</a>.</p><p>The dscmd client includes a <code class="literal">--help</code> switch.</p><p>To set up dscmd, create a configuration file <code class="literal">~/.dscmd-server.conf</code> with the following content:</p><pre class="screen">server=[HOST]
port=[PORT]
validtargets=[TARGETS]</pre><p>Replace <code class="literal"><span class="emphasis"><em>[HOST]</em></span></code>, <code class="literal"><span class="emphasis"><em>[PORT]</em></span></code>, and <code class="literal"><span class="emphasis"><em>[TARGETS]</em></span></code> with values appropriate for your installation.
Target names must match the names defined using the <code class="literal">name</code> attribute of the target sections in the site configuration (<a class="xref" href="config-site.html#config-site-target-section" title="Target sections">the section called “Target sections”</a>).
You can combine multiple target values using commas characters (<code class="literal">,</code>), for example: <code class="literal">validtargets=target_1,target_2</code>.
(Do not add spaces around the comma characters.)</p><p>This configuration file will be sourced by Bash.
This means it must follow Bash syntax (and may contain arbitrary code).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api-call"></a>API calls</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="api-check-build"></a>Checking build status</h3></div></div></div><p>To check the current build statuses and review the past build queue, make a <code class="literal">GET</code> request to the JSON endpoint <code class="literal">http://<span class="emphasis"><em>[HOST]</em></span>:<span class="emphasis"><em>[PORT]</em></span>/</code>.</p><p>Alternatively, use <code class="literal"><span class="strong"><strong>dscmd queue</strong></span></code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="api-send-build-instruction"></a>Sending a build instruction</h3></div></div></div><p>To send a build instruction, make a <code class="literal">POST</code> request to the endpoint <code class="literal">http://<span class="emphasis"><em>[HOST]</em></span>:<span class="emphasis"><em>[PORT]</em></span>/</code> with JSON data attached:</p><pre class="screen">&gt; curl \
    --header "Content-Type: application/json" \
    --request POST \
    --data '{"target":"[TARGET]","product":"[PRODUCT]","docset":"[DOCSET]","lang":"[LANGUAGE_CODE]"}' \
    [HOST]:[PORT]</pre><p>Replace <code class="literal"><span class="emphasis"><em>[TARGET]</em></span></code>, <code class="literal"><span class="emphasis"><em>[PRODUCT]</em></span></code>, <code class="literal"><span class="emphasis"><em>[DOCSET]</em></span></code>, <code class="literal"><span class="emphasis"><em>[LANGUAGE_CODE]</em></span></code>, <code class="literal"><span class="emphasis"><em>[HOST]</em></span></code>, and <code class="literal"><span class="emphasis"><em>[PORT]</em></span></code> with appropriate values.
You can combine multiple build instructions into a single <code class="literal">POST</code> requests by sending a data field with multiple JSON objects separated with comma characters (<code class="literal">,</code>).</p><p>Alternatively, use:</p><pre class="screen">&gt; dscmd trigger \
    --target=__[TARGET]__
    --product=__[PRODUCT_ID]__ --docset=__[DOCSET_ID]__
    --lang=__[LANGUAGE_CODE]__**`.</pre><p>Within each parameter, you can combine multiple values using comma characters (<code class="literal">,</code>), for example: <code class="literal">--target=target_1,target_2</code>.
(Do not add spaces around the comma characters. Always use equal-to characters [<code class="literal">=</code>] as shown in the example.)</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top">Chapter 10. Backing up Docserv² data </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>